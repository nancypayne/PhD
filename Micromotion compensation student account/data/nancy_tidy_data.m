tt1 = [3.49900000000000,4.49700000000000,5.49500000000000,6.49300000000000,7.49100000000000,8.48900000000000,9.48700000000000,10.4850000000000,11.4830000000000,12.4810000000000,13.4790000000000,14.4770000000000,15.4750000000000,16.4730000000000,17.4710000000000,18.4690000000000,19.4670000000000,20.4650000000000,21.4630000000000,22.4610000000000,23.4590000000000,24.4570000000000,25.4550000000000,26.4530000000000,27.4510000000000,28.4490000000000,29.4470000000000,30.4450000000000,31.4430000000000,32.4410000000000,33.4390000000000,34.4370000000000,35.4350000000000,36.4330000000000,37.4310000000000,38.4290000000000,39.4270000000000,40.4250000000000,41.4230000000000,42.4210000000000,43.4190000000000,44.4170000000000,45.4150000000000,46.4130000000000,47.4110000000000,48.4090000000000,49.4070000000000,50.4050000000000,51.4030000000000,52.4010000000000,53.3990000000000,54.3970000000000,55.3950000000000,56.3930000000000,57.3910000000000,58.3890000000000,59.3870000000000,60.3850000000000,61.3830000000000,62.3810000000000,63.3790000000000,64.3770000000000,65.3750000000000,66.3730000000000,67.3710000000000,68.3690000000000,69.3670000000000,70.3650000000000,71.3630000000000,72.3610000000000,73.3590000000000,74.3570000000000,75.3550000000000,76.3530000000000,77.3510000000000,78.3490000000000,79.3470000000000,80.3450000000000,81.3430000000000,82.3410000000000,83.3390000000000,84.3370000000000,85.3350000000000,86.3330000000000,87.3310000000000,88.3290000000000,89.3270000000000,90.3250000000000,91.3230000000000,92.3210000000000,93.3190000000000,94.3170000000000,95.3150000000000,96.3130000000000,97.3110000000000,98.3090000000000,99.3070000000000];
hc_250_2 = [237,275,276,271,244,193,190,118,106,131,192,257,237,285,284,256,237,158,117,114,139,193,262,276,268,293,226,214,161,115,121,138,221,274,276,288,261,253,202,150,128,102,155,220,261,280,282,266,259,199,196,126,110,167,232,275,249,267,257,227,168,152,96,118,160,223,258,284,268,283,262,206,130,114,115,146,236,248,258,272,247,233,171,123,124,100,161,240,258,277,273,245,201,183,129,121,121];
hc_250_3 = [226,263,265,283,258,208,168,105,98,124,180,272,259,226,284,238,235,161,91,79,119,192,236,263,243,245,261,208,138,101,81,113,201,286,278,264,270,275,236,142,112,83,154,210,292,287,278,242,259,226,126,80,94,140,184,262,268,300,265,227,204,155,112,87,150,215,268,235,282,270,238,180,122,96,106,143,220,285,262,279,268,231,208,135,94,75,152,226,296,250,309,253,240,205,123,98,85];
hc_300_2 = [311,318,339,317,292,242,211,154,143,169,235,307,326,342,317,287,232,203,155,111,180,214,328,330,346,357,279,265,200,131,129,181,245,328,334,321,321,316,249,199,127,140,165,284,321,351,331,326,308,245,180,129,135,206,258,325,329,363,311,267,234,160,115,134,188,259,337,336,328,332,274,227,161,142,158,191,263,307,344,318,312,260,215,201,136,133,208,271,303,354,348,338,270,207,172,85,114];

tt2 = [5.50000000000000;6.50000000000000;7.50000000000000;8.50000000000000;9.50000000000000;10.5000000000000;11.5000000000000;12.5000000000000;13.5000000000000;14.5000000000000;15.5000000000000;16.5000000000000;17.5000000000000;18.5000000000000;19.5000000000000;20.5000000000000;21.5000000000000;22.5000000000000;23.5000000000000;24.5000000000000;25.5000000000000;26.5000000000000;27.5000000000000;28.5000000000000;29.5000000000000;30.5000000000000;31.5000000000000;32.5000000000000;33.5000000000000;34.5000000000000;35.5000000000000;36.5000000000000;37.5000000000000;38.5000000000000;39.5000000000000;40.5000000000000;41.5000000000000;42.5000000000000;43.5000000000000;44.5000000000000;45.5000000000000;46.5000000000000;47.5000000000000;48.5000000000000;49.5000000000000;50.5000000000000;51.5000000000000;52.5000000000000;53.5000000000000;54.5000000000000;55.5000000000000;56.5000000000000;57.5000000000000;58.5000000000000;59.5000000000000;60.5000000000000;61.5000000000000;62.5000000000000;63.5000000000000;64.5000000000000;65.5000000000000;66.5000000000000;67.5000000000000;68.5000000000000;69.5000000000000;70.5000000000000;71.5000000000000;72.5000000000000;73.5000000000000;74.5000000000000;75.5000000000000;76.5000000000000;77.5000000000000;78.5000000000000;79.5000000000000;80.5000000000000;81.5000000000000;82.5000000000000;83.5000000000000;84.5000000000000;85.5000000000000;86.5000000000000;87.5000000000000;88.5000000000000;89.5000000000000;90.5000000000000;91.5000000000000;92.5000000000000;93.5000000000000;94.5000000000000;95.5000000000000;96.5000000000000;97.5000000000000;98.5000000000000;99.5000000000000];
lc_100_hc_0 = [252;295;423;469;454;382;282;254;236;230;209;246;323;407;453;444;343;277;231;236;208;212;261;314;394;432;464;345;293;228;206;227;228;237;348;410;484;445;323;258;237;213;204;235;261;325;439;479;406;340;280;241;218;223;230;276;387;446;506;412;315;283;215;205;224;251;297;305;452;437;422;302;261;190;210;215;227;285;393;460;469;377;292;251;213;213;221;243;311;390;505;460;429;299;260];

figure(1), clf, 
subplot(121), hold on
plot(tt, hc_200_2)
plot(tt1, hc_250_2)
plot(tt1, hc_300_2)
legend('HC 200 V', 'HC 250 V', 'HC 300 V')
title('Effect of hi comp voltage on micromotion')
hold off

subplot(122), hold on
plot(tt1, hc_300_2)
plot(tt2, lc_100_hc_0)
legend('HC 300 V', 'HC 0, LC 100 V')
hold off
shg

% let's look at lc_100_hc_0 first
x = tt2;
y = lc_100_hc_0;

% --- fit sinuoid to data

offset = mean(y);

yu = max(y);
yl = min(y);
amp = (yu - yl)/2;                             % Range of y

Fs = 1;            % Sampling frequency                  
T = 1/Fs;             % Sampling period       
L = length(x);             % Length of signal
t = (0:L-1)*T;        % Time vector

% compute fft of data (see Matlab help page on fft)
fy = fft(y); 
P2 = abs(fy/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

% define frequency domain f...
f = Fs*(0:(L/2))/L;

% plot(f,P1) 
% title('Single-Sided Amplitude Spectrum of X(t)')
% xlabel('f (Hz)')
% ylabel('|P1(f)|')
% shg

% % -----------------
%  
% yz = y - amp;                       % shift data to around x=0
% zx = yz.*circshift(yz,[0 1]) <= 3800;     % Find zero-crossings
% 
% % per = 2*mean(diff(zx))                    % Estimate period
% % I don't know how this is meant to work... or be non-zero.
% per = 20;   % reading off plot
% freq = 0.5;
% 
% ym = mean(y);                               % Estimate offset
% 
% phase = 0;
% 
% p  = [amp, freq, phase, offset];
% lb = [140, 0, -2*pi, 330];
% ub = [300, inf, 2*pi, inf];
% 
% % define function you're fitting the data to
% my_fit = @(p, t) p(1)*sin(p(2)*t + p(3)) + p(4);
% 
% p = lsqcurvefit(my_fit, p, x, y, lb, ub)
% tt = linspace(x(1), x(end), 1001);
% 
% figure(1), clf, hold on
% plot(x, y, '*')
% plot(tt, my_fit(p, tt), 'Linewidth', 1)
% hold off
% ylim([0 1.1*max(data)])
% shg
% 
% % [tt, my_fit, p] = my_sine_fit(x, y, amp, 0.5, -3, offset);
% % p
% 
% % figure(1), clf, hold on
% % plot(time, data, '*')
% % plot(tt, my_fit, '-')
% % hold off
% % xlabel('Time (ticks, 1 tick = X ns)')
% % ylabel('Fluorescence signal')
% % legend('Data', 'Fit')
% % shg
% 
% % --- notes on estimating zero crossings:
% % yz = data that oscillates around x = 0.
% % circshift(yz,[0 1]) shifts every element of yz left one.
% % multiplying yz.*circshift means all entries will be positive, apart from
% % ones that were close to a zero crossing (+ * - = -).
% % obtain indices for all entries that are <= 0.
% % multiply by x data to turn indices into x values of zero crossings.
% 
% % --- notes on estimating the period
% % 