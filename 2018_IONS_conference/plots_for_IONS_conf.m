% micromotion: change high comp voltage to affect micromotion amplitude

time = [3.49900000000000,4.49700000000000,5.49500000000000,6.49300000000000,7.49100000000000,8.48900000000000,9.48700000000000,10.4850000000000,11.4830000000000,12.4810000000000,13.4790000000000,14.4770000000000,15.4750000000000,16.4730000000000,17.4710000000000,18.4690000000000,19.4670000000000,20.4650000000000,21.4630000000000,22.4610000000000,23.4590000000000,24.4570000000000,25.4550000000000,26.4530000000000,27.4510000000000,28.4490000000000,29.4470000000000,30.4450000000000,31.4430000000000,32.4410000000000,33.4390000000000,34.4370000000000,35.4350000000000,36.4330000000000,37.4310000000000,38.4290000000000,39.4270000000000,40.4250000000000,41.4230000000000,42.4210000000000,43.4190000000000,44.4170000000000,45.4150000000000,46.4130000000000,47.4110000000000,48.4090000000000,49.4070000000000,50.4050000000000,51.4030000000000,52.4010000000000,53.3990000000000,54.3970000000000,55.3950000000000,56.3930000000000,57.3910000000000,58.3890000000000,59.3870000000000,60.3850000000000,61.3830000000000,62.3810000000000,63.3790000000000,64.3770000000000,65.3750000000000,66.3730000000000,67.3710000000000,68.3690000000000,69.3670000000000,70.3650000000000,71.3630000000000,72.3610000000000,73.3590000000000,74.3570000000000,75.3550000000000,76.3530000000000,77.3510000000000,78.3490000000000,79.3470000000000,80.3450000000000,81.3430000000000,82.3410000000000,83.3390000000000,84.3370000000000,85.3350000000000,86.3330000000000,87.3310000000000,88.3290000000000,89.3270000000000,90.3250000000000,91.3230000000000,92.3210000000000,93.3190000000000,94.3170000000000,95.3150000000000,96.3130000000000,97.3110000000000];
time_ns = [0:6.25:length(time)*6.25-1];

time2 = [3.49900000000000,4.49700000000000,5.49500000000000,6.49300000000000,7.49100000000000,8.48900000000000,9.48700000000000,10.4850000000000,11.4830000000000,12.4810000000000,13.4790000000000,14.4770000000000,15.4750000000000,16.4730000000000,17.4710000000000,18.4690000000000,19.4670000000000,20.4650000000000,21.4630000000000,22.4610000000000,23.4590000000000,24.4570000000000,25.4550000000000,26.4530000000000,27.4510000000000,28.4490000000000,29.4470000000000,30.4450000000000,31.4430000000000,32.4410000000000,33.4390000000000,34.4370000000000,35.4350000000000,36.4330000000000,37.4310000000000,38.4290000000000,39.4270000000000,40.4250000000000,41.4230000000000,42.4210000000000,43.4190000000000,44.4170000000000,45.4150000000000,46.4130000000000,47.4110000000000,48.4090000000000,49.4070000000000,50.4050000000000,51.4030000000000,52.4010000000000,53.3990000000000,54.3970000000000,55.3950000000000,56.3930000000000,57.3910000000000,58.3890000000000,59.3870000000000,60.3850000000000,61.3830000000000,62.3810000000000,63.3790000000000,64.3770000000000,65.3750000000000,66.3730000000000,67.3710000000000,68.3690000000000,69.3670000000000,70.3650000000000,71.3630000000000,72.3610000000000,73.3590000000000,74.3570000000000,75.3550000000000,76.3530000000000,77.3510000000000,78.3490000000000,79.3470000000000,80.3450000000000,81.3430000000000,82.3410000000000,83.3390000000000,84.3370000000000,85.3350000000000,86.3330000000000,87.3310000000000,88.3290000000000,89.3270000000000,90.3250000000000,91.3230000000000,92.3210000000000,93.3190000000000,94.3170000000000,95.3150000000000,96.3130000000000,97.3110000000000,98.3090000000000,99.3070000000000];
time2_ns = [0:6.25:length(time2)*6.25-1];

LC000 = [362,373,399,370,355,306,242,179,175,195,315,381,410,385,383,339,331,230,186,188,181,296,384,359,365,385,370,289,224,172,151,196,328,395,345,423,375,342,275,243,172,164,206,329,388,369,380,363,319,273,191,168,165,239,322,382,391,370,377,315,296,219,169,174,239,302,373,397,370,338,296,282,215,157,175,256,348,370,408,376,326,307,251,219,192,168,247,333,383,395,394,370,314,262,218];
LC100 = [364,350,363,366,315,303,285,269,235,283,332,339,341,330,322,321,296,320,235,223,251,315,372,375,364,329,320,328,321,236,245,270,321,349,356,368,370,308,297,270,242,220,274,358,304,349,371,334,344,308,293,255,215,271,326,364,376,350,334,335,289,287,223,237,268,376,338,320,352,363,327,300,289,225,234,291,359,346,357,354,351,293,289,282,237,222,297,357,330,358,386,362,330,320,296];
LC150 = [121,163,168,161,133,127,101,94,83,87,114,141,147,159,149,144,112,94,93,84,110,115,164,156,150,152,129,128,99,94,100,119,133,144,143,151,150,135,122,111,87,69,104,119,138,144,158,158,132,113,109,96,84,97,133,123,147,161,161,147,99,121,93,89,103,126,154,155,169,156,126,100,103,99,83,107,137,133,156,167,133,120,114,113,82,101,119,124,164,135,159,122,122,100,91];
LC200 = [111,104,129,119,120,130,140,141,133,129,117,147,122,115,118,98,137,131,124,145,117,127,119,113,126,109,113,129,129,135,130,149,129,111,135,126,119,113,122,131,126,144,130,122,132,139,117,137,134,141,118,128,120,133,126,116,108,107,125,110,127,141,130,129,133,131,136,105,133,131,124,132,137,126,140,139,119,128,114,109,133,124,123,100,140,136,131,117,116,117,109,125,129,112,121];
LC250 = [172,125,142,120,122,155,215,213,182,213,222,164,111,133,130,143,137,206,223,160,195,229,160,117,121,113,134,173,201,198,195,224,209,131,105,117,117,136,173,206,191,184,201,214,132,124,129,115,128,198,208,208,212,245,183,144,118,127,120,127,164,198,193,169,209,192,162,137,101,117,150,194,212,181,182,219,199,138,130,118,97,127,180,213,178,224,234,205,129,123,110,129,143,191,184,198,188];


figure(1), clf, hold on
plot(time_ns, LC000 + 670, 'LineWidth', 3)
plot(time_ns, LC100 + 290, 'LineWidth', 3)
plot(time_ns, LC150 + 170, 'Color', [90/255, 143/255, 41/255], 'LineWidth', 3)
plot(time_ns, LC200 - 120, 'LineWidth', 3)
plot(linspace(0, time_ns(end), 100), 150*ones(1,100), 'Color', [0.8, 0.8, 0.8])
plot(linspace(0, time_ns(end), 100), 450*ones(1,100), 'Color', [0.8, 0.8, 0.8])
plot(linspace(0, time_ns(end), 100), 750*ones(1,100), 'Color', [0.8, 0.8, 0.8])
hold off
xlabel('Time /ns', 'FontSize', 20)
ylabel('Photon scattering rate \propto ion velocity', 'FontSize', 20)
% title('Effect of compensation voltage on micromotion amplitude')
set(gca,'YTick',[]);
set(gca,'YTickLabel',[]);
set(gca, 'FontSize', 15);
xlim([0, time_ns(end)])
ylim([-130 1170])
legend({'    0 V', '100 V', '200 V', '250 V'}, 'FontSize', 13)


% micromotion: change voltage to induce "phase flip"

time2 = [3.49900000000000,4.49700000000000,5.49500000000000,6.49300000000000,7.49100000000000,8.48900000000000,9.48700000000000,10.4850000000000,11.4830000000000,12.4810000000000,13.4790000000000,14.4770000000000,15.4750000000000,16.4730000000000,17.4710000000000,18.4690000000000,19.4670000000000,20.4650000000000,21.4630000000000,22.4610000000000,23.4590000000000,24.4570000000000,25.4550000000000,26.4530000000000,27.4510000000000,28.4490000000000,29.4470000000000,30.4450000000000,31.4430000000000,32.4410000000000,33.4390000000000,34.4370000000000,35.4350000000000,36.4330000000000,37.4310000000000,38.4290000000000,39.4270000000000,40.4250000000000,41.4230000000000,42.4210000000000,43.4190000000000,44.4170000000000,45.4150000000000,46.4130000000000,47.4110000000000,48.4090000000000,49.4070000000000,50.4050000000000,51.4030000000000,52.4010000000000,53.3990000000000,54.3970000000000,55.3950000000000,56.3930000000000,57.3910000000000,58.3890000000000,59.3870000000000,60.3850000000000,61.3830000000000,62.3810000000000,63.3790000000000,64.3770000000000,65.3750000000000,66.3730000000000,67.3710000000000,68.3690000000000,69.3670000000000,70.3650000000000,71.3630000000000,72.3610000000000,73.3590000000000,74.3570000000000,75.3550000000000,76.3530000000000,77.3510000000000,78.3490000000000,79.3470000000000,80.3450000000000,81.3430000000000,82.3410000000000,83.3390000000000,84.3370000000000,85.3350000000000,86.3330000000000,87.3310000000000,88.3290000000000,89.3270000000000,90.3250000000000,91.3230000000000,92.3210000000000,93.3190000000000,94.3170000000000,95.3150000000000,96.3130000000000,97.3110000000000,98.3090000000000,99.3070000000000];
time2_ns = [0:6.25:length(time2)*6.25-1];
data1 = [362,373,399,370,355,306,242,179,175,195,315,381,410,385,383,339,331,230,186,188,181,296,384,359,365,385,370,289,224,172,151,196,328,395,345,423,375,342,275,243,172,164,206,329,388,369,380,363,319,273,191,168,165,239,322,382,391,370,377,315,296,219,169,174,239,302,373,397,370,338,296,282,215,157,175,256,348,370,408,376,326,307,251,219,192,168,247,333,383,395,394,370,314,262,218,158,156];
data2 = [172,125,142,120,122,155,215,213,182,213,222,164,111,133,130,143,137,206,223,160,195,229,160,117,121,113,134,173,201,198,195,224,209,131,105,117,117,136,173,206,191,184,201,214,132,124,129,115,128,198,208,208,212,245,183,144,118,127,120,127,164,198,193,169,209,192,162,137,101,117,150,194,212,181,182,219,199,138,130,118,97,127,180,213,178,224,234,205,129,123,110,129,143,191,184,198,188];

x1 = 31;
x2 = 74;
time2_ns = time2_ns(x1:x2);
data1 = data1(x1:x2);
data2 = data2(x1:x2);

line1 = linspace(500,700,100);
L = 100;

figure(2), clf, hold on
plot(time2_ns, data2*2 + 270, 'LineWidth', 3)
plot(time2_ns, data1, 'LineWidth', 3)
plot(287*ones(1,L), linspace(0,1000,L), 'k--', 'LineWidth', 1)
plot(355*ones(1,L), linspace(0,1000,L), 'k--', 'LineWidth', 1)
hold off
xlabel('Time /ns', 'FontSize', 20)
ylabel('Photon scattering rate \propto ion velocity', 'FontSize', 20)
set(gca,'YTick',[]);
set(gca,'YTickLabel',[]);
set(gca, 'FontSize', 15);
xlim([time2_ns(1), time2_ns(end)])
ylim([90, 830])
legend({'    0 V', '250 V'}, 'FontSize', 13)


% Rabi oscillations: 
time_R = 12.5/1000*[0,80,160,240,320,400,480,560,640,720,800,880,960,1040,1120,1200,1280,1360,1440,1520,1600,1680,1760,1840,1920,2000,2080,2160,2240,2320,2400,2480,2560,2640,2720,2800,2880,2960,3040,3120,3200,3280,3360,3440,3520,3600,3680,3760,3840,3920,4000,4080,4160,4240,4320,4400,4480,4560,4640,4720,4800,4880,4960,5040,5120,5200,5280,5360,5440,5520,5600,5680,5760,5840,5920,6000,6080,6160,6240,6320,6400,6480,6560,6640,6720,6800,6880,6960,7040,7120,7200,7280,7360,7440,7520,7600,7680,7760,7840,7920,8000,8080,8160,8240,8320,8400,8480,8560,8640,8720,8800,8880,8960,9040,9120,9200,9280,9360,9440,9520,9600,9680,9760,9840,9920,10000,10080,10160,10240,10320,10400,10480,10560,10640,10720,10800,10880,10960,11040,11120,11200,11280,11360,11440,11520,11600,11680,11760,11840,11920,12000,12080,12160,12240,12320,12400,12480,12560,12640,12720,12800,12880,12960,13040,13120,13200,13280,13360,13440,13520,13600,13680,13760,13840,13920,14000,14080,14160,14240,14320,14400,14480,14560,14640,14720,14800,14880,14960,15040,15120,15200,15280,15360,15440,15520,15600,15680,15760,15840,15920,16000,16080,16160,16240,16320,16400,16480,16560,16640,16720,16800,16880,16960,17040,17120,17200,17280,17360,17440,17520,17600,17680,17760,17840,17920,18000,18080,18160,18240,18320,18400,18480,18560,18640,18720,18800,18880,18960,19040,19120,19200,19280,19360,19440,19520,19600,19680,19760,19840,19920,20000,20080,20160,20240,20320,20400,20480,20560,20640,20720,20800,20880,20960,21040,21120,21200,21280,21360,21440,21520,21600,21680,21760,21840,21920,22000,22080,22160,22240,22320,22400,22480,22560,22640,22720,22800,22880,22960,23040,23120,23200,23280,23360,23440,23520,23600,23680,23760,23840,23920,24000,24080,24160,24240,24320,24400,24480,24560,24640,24720,24800,24880,24960,25040,25120,25200,25280,25360,25440,25520,25600,25680,25760,25840,25920];
% convert from ticks to microseconds (1 tick = 12.5 ns)
% time_R = time_R * 12.5 ;

data_R = [363,359,389,415,445,512,518,584,660,708,795,851,887,848,930,922,985,962,983,950,944,908,828,786,745,689,619,541,528,486,441,399,395,360,346,306,345,379,388,472,505,540,590,612,654,690,748,807,753,862,864,890,880,788,822,834,750,760,717,624,581,555,483,457,410,399,374,309,302,310,313,316,355,333,380,391,427,488,535,532,607,636,719,689,756,737,683,657,703,633,605,651,582,514,497,464,418,400,345,323,343,289,248,272,255,252,290,283,307,315,365,407,384,435,476,530,499,571,564,583,549,581,608,586,562,495,524,518,486,473,465,429,383,350,344,300,297,292,249,249,253,277,291,307,284,330,407,398,429,477,497,520,546,536,584,574,615,588,539,576,607,503,529,447,490,431,433,408,352,309,297,295,284,270,266,264,253,292,315,303,306,348,374,379,399,443,470,528,508,510,500,481,495,516,504,482,526,478,455,459,399,398,333,316,318,296,264,268,252,229,272,227,234,240,261,271,333,330,348,354,370,380,402,443,406,419,445,522,446,470,448,378,390,386,386,335,336,308,314,276,242,255,254,214,237,221,238,234,269,291,287,287,304,305,325,328,386,363,349,372,398,392,347,351,342,328,325,301,285,316,252,234,236,247,224,195,176,192,181,163,168,157,168,161,180,190,182,138,150,125,133,116,102,126,126,130,134,117,110,127,128,117,130,113,122,126,125,128,115,103,131,103,100,137,114,123,103,105,122,123,120,121,115,141,112];

figure(3), clf, hold on
plot(time_R, data_R, 'LineWidth', 3)
plot(linspace(0, time_R(end), 100), 100*ones(1,100), 'k--')% 'Color', [0.4, 0.4, 0.4])
xlabel('Microwave pulse duration /us', 'FontSize', 20)
ylabel('Ion fluorescence (photon count)', 'FontSize', 20)
% set(gca,'YTickLabel',[]);
set(gca, 'FontSize', 15);
xlim([time_R(1), time_R(end)])
ylim([0, max(data_R)+150])
grid on